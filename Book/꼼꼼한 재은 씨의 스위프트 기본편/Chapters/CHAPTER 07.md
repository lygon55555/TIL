# CHAPTER 07 – 델리게이트 패턴

- iOS 앱의 객체는 델리게이트 패턴(Delegate Pattern)이라고 불리는 일종의 위임 패턴을 많이 사용함.
- 객체지향 프로그래밍에서 객체 간의 관계가 중요한데, 설계에 관한 문제를 해결하기 위한 해법으로 객체들의 관계를 구조화한 사례가 일반화된 것을 디자인 패턴이라고 함.
- 디자인 패턴은 알고리즘처럼 프로그램 코드로 바로 변환될 수 있는 형태는 아니지만, 특정한 상황에서 구조적 문제를 해결하는 방식을 설명해줌
- 알아두면 좋은 패턴들
    - 팩토리 패턴(Factory Pattern)
    - 옵저버 패턴(Observer Pattern)
    - 데코레이터 패턴(Decorator Pattern)
    - 싱글톤 패턴(Singleton Pattern)
    - 어댑터 패턴(Adapter Pattern)
    - 이터레이터 패턴(Iterator Pattern)
    - 델리게이트 패턴(Delegate Pattern)
- 델리게이트 패턴은 쉽게 말해 객체지향 프로그래밍에서 하나의 객체가 모든 일을 처리하는 것이 아니라 처리해야 할 일 중 일부를 다른 객체에 넘기는 것을 말함
- GUI 기반 프로그래밍에서 델리게이트 패턴이 사용되는 가장 대표적인 예는 이벤트 리스너(Event Listener)이다.
- 기능을 처리할 객체를 델리게이트로 설정하고, 특정 이벤트가 발생할 때 이를 델리게이트에 의해 위임된 본래의 객체로 전달해주는 역할을 함.
- 특정 이벤트가 발생했을 때 알려주는 방법이 바로 미리 정의된 델리게이트 메소드를 사용하는 것임. 이를 위해 iOS에서 델리게이트 패턴을 사용하는 모든 객체는 델리게이트 메소드를 정의한 프로토콜을 가짐. 이를 델리게이트 프로토콜이라고 하는데, 보통 객체의 이름 뒤에 Delegate를 붙여서 정의함. 우리가 델리게이트 메소드를 이용하려면 델리게이트 프로토콜을 구현하는 과정이 반드시 필요함.

# 7.1 텍스트필드

- 델리게이트 패턴을 구현하려면 모든 객체는 그에 맞는 델리게이트 프로토콜을 구현해야 함.
- 델리게이트 프로토콜을 구현하고 나면 이어지는 작업은 해당 객체의 델리게이트 속성을 뷰 컨트롤러와 연결하는 것임. 이때 델리게이트 속성이란, 델리게이트 메소드가 구현되어 있는 객체를 의미함.

## 7.1.1 텍스트 필드의 특성

- UIWindow 객체는 사용자 인터페이스 구조에서 사용자에 가장 가까이 위치한 객체로, 사용자로부터 발생하는 터치 관련 이벤트를 내부 객체로 전달하는 역할을 담당. 이를 위해 UIWindow는 이벤트가 발생했을 때 우선적으로 응답할 객체를 가리키는 최초 응답자(First Responder)라는 포인터를 가지고 있음
- 모바일 기기에서 발생하는 모션 이벤트(터치, 드래그, 스와이프 등)는 모두 최초 응답자 포인터에 연결된 객체로 전달됨.
- 특정 객체를 최초 응답자로 만들고 싶다면 그 객체에 대한 becomeFirstResponder() 메소드를 호출하면 됨.
- 화면에 키보드가 표시된 상태에서 다른 요소를 건드려도 키보드가 사라지지 않는 것은 이 때문. 다른 요소를 터치하더라도 그 객체가 UIResponder를 상속받지 않았다면 터치 이벤트만 발생할 뿐, 최초 응답자 포인터는 텍스트 필드를 그대로 가리키기 때문임. 해당 객체로부터 최초 응답자 상태를 해제하고 싶을 때에는 resignFirstResponder() 메소드를 호출하면 됨.
- 텍스트 필드의 테두리 속성인 borderWidth, borderColor는 텍스트 필드 자체의 속성이 아니라 하위 객체인 layer 속성에 정의되어 있음. iOS에서 색상을 처리하는 객체는 UIColor이지만, 텍스트 필드의 테두리 색상은 그보다 저수준에서 구현된 CGColor 타입의 값을 사용함.

## 7.1.2. 텍스트 필드에 델리게이트 패턴 적용하기

- 델리게이트 패턴을 적용할 때 가장 먼저 할 일은 델리게이트 프로토콜에 대한 구현을 선언하는 것
- textField.delegate = self 텍스트 필드의 delegate는 텍스트 필드에 특정 이벤트가 발생했을 때 알려줄 대상 객체를 가리키는 속성이다. 이 속성에 대입된 self는 현재의 뷰 컨트롤러 인스턴스를 의미. 즉, 텍스트 필드에서 미리 정해진 특정 이벤트가 발생하면 현재의 뷰 컨트롤러에게 알려달라는 요청이고 이를 가리켜 “뷰 컨트롤러가 텍스트 필드의 델리게이트 객체로 지정되었다”라고 표현함.
- 텍스트 필드가 자신의 델리게이트 객체에게 특정 이벤트가 발생했음을 알려줄 때에는 델리게이트 메소드를 이용함.
- textField(_:shouldChangeCharactersIn:replacementString:) 메소드는 텍스트 필드에 값이 입력되었을 때 호출되며, 이때 편집되는 문자열도 함께 전달됨. 이를 응용하면 텍스트 필드에 입력된 값을 통제할 수 있음.

# 7.2 이미지 피커 컨트롤러(Image Picker Controller)

## 7.2.1 UIImagePickerController 클래스

- 이미지 피커 컨트롤러는 인터페이스 빌더의 오브젝트 라이브러리에 포함되어 있지 않으므로 스토리보드를 이용하여 구성할 수 없으며, 소스 코드를 사용하여 직접 인스턴스를 생성하고 화면을 호출해야 함
- 이미지 피커 컨트롤러를 사용하는 방식은 UIAlertController와 유사함
- 이미지 피커 컨트롤러의 sourceType은 어떤 소스를 기반으로 이미지를 가져올 것인지 선택하는 속성이고 열거형 타입을 정의되어 있음

## 7.2.2 이미지 피커 컨트롤러의 델리게이트 메소드

- imagePickerController(_:didFinishPickingMediaWithInfo:) 메소드는 이미지 피커 컨트롤러에서 이미지를 선택하거나 카메라 촬영을 완료했을 때 호출되는 메소드
    - 첫 번째 인자값은 이 메소드를 호출하는 이미지 피커 컨트롤러 객체
    - 두 번째 인자값은 우리가 원하는 이미지에 대한 데이터인데 이미지 객체에 대한 종합 정보가 딕셔너리 형태로 전달됨
- imagePickerControllerDidCancel(_:)은 이미지 피커 컨트롤러가 실행된 후 이미지 선택 없이 그냥 취소했을 때 호출되는 메소드

## 7.2.3 이미지 피커 컨트롤러 실습

- iOS 10 이후로 강화된 프라이버시 규정 때문에 앱 내부의 사적 공간에 접근하려고 하면 반드시 사전에 plist에 관련 항목에 대한 접속 여부를 설정해야 함.
- 사진 라이브러리뿐만 아니라 음악, 위치 정보, 주소록 등 많은 사적 공간에 접근할 때에도 이와 마찬가지로 명시적인 접근 선언을 해 주어야 함. Privacy – 로 시작하는 대부분의 키 값들이 이 같은 사적 데이터 공간에 접근하기 위해 설정해야 하는 항목들이다.
- 델리게이트 메소드를 구현하게 되면 컨트롤러 창을 닫기 위한 dismiss(animated:) 메소드를 직접 호출해 주어야 이미지 피커 창이 닫히고 원래의 뷰 컨트롤러로 돌아올 수 있음
- 읽어온 값은 이미지 데이터를 담고 있지만 범용 객체인 Any 타입이라서 UIImage 타입으로 캐스팅한 다음에야 이미지 객체로 활용할 수 있는 상태가 됨.

## 7.2.4 익스텐션(Extension)을 이용한 델리게이트 패턴 코딩

- 익스텐션과 MARK 주석(// MARK:-) 등을 활용하면 코드를 깔끔하게 정리할 수 있음
