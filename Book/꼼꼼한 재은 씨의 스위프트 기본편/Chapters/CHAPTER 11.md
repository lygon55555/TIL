# CHAPTER 11 - 웹 뷰(앱에서 웹 페이지를 여는 방법)

- 애플이 지원하는 웹 브라우저 구현의 대표적인 4가지 방식
    - 사파리 앱 호출하기
    - UIWebView 구현하기
    - WKWebView 구현하기
    - SFSafariViewController 구현하기
- 웹 뷰(Web View)는 웹 페이지를 탐색하기 위해 사용하는 뷰(View) 객체로, 앱 안에 심을 수 있는 일종의 내장형 웹 브라우저이다.
- 인앱 브라우저(In-App Browser)는 단순히 URL을 호출하여 웹 페이지를 보여주는 기본 기능 정도만 제공하기 때문에 앞으로 가기/뒤로 가기/북마크 등의 기능은 직접 구현해야 함.
- ATS(App Transport Security) 설정은 앱 내부에서 URLSession, URLRequest 관련 객체를 쓸 때에만 필요함
- WKWebView는 UIKit이 아닌 WebKit 프레임워크에서 제공됨
- SFSafariViewController는 컨트롤러 객체이고 사파리 서비스(Safari Service) 프레임워크를 통해 제공된다. 특정 메소드를 호출하는 것이 아니라 화면을 전환하는 방식으로 해당 컨트롤러를 호출해야 하며 이미지 피커 컨트롤러를 사용하는 방식과 유사하다.

# 11.1 WKWebView를 이용하여 영화 정보 상세 화면 구현하기

- 내비게이션 바는 실제 위치와 공간을 배타적으로 점유하는 객체가 아니라, 기존 객체의 위에 겹쳐지는 레이어 형태이다.
- 내비게이션 바에 제목을 넣으려면 먼저 내비게이션 아이템을 추가해야 함. 내비게이션 타이틀은 내비게이션 아이템 객체를 통해서만 사용할 수 있는데, 내비게이션 아이템은 내비게이션 바의 기본 요소가 아니기 때문
- 멤버 변수가 Int, String, Float, Bool 등의 기본 타입만으로 이루어진다면 VO는 구조체를 사용하고, 클래스 타입의 멤버 변수가 포함된다면 VO 역시 클래스를 사용하는 것이 좋음. 이는 구조체와 클래스가 가지고 있는 핵심적인 차이 중 하나인 ‘값에 의한 전달’과 ‘참조에 의한 전달’ 때문이다.
- 만약 값이 늘어날 때마다 멤버 변수를 추가하는 것이 불편해서 VO를 만들기가 싫다면, 대신 Dictionary 또는 NSMutableDictionary 객체를 사용할 수 있음. 이 객체는 단순히 키-값 형태로 정보를 전달하면 된다. NSMutableDictionary 객체가 실무에서 더 많이 사용되는데, 이것은 저장 타입이 한 가지로 고정되어 있는 Dictionary 보다는 NSMutableDictionary 타입이 훨씬 유연하고 사용성이 좋기 때문이다.
- prepare(for:sender:)는 세그웨이를 통해 화면이 전환될 때 iOS 시스템이 자동으로 호출하는 메소드이다. 만약 화면 이동 전에 실행해야 할 코드가 있거나 특별한 전처리를 해야 한다면 모두 이 메소드 내에 코드를 작성해야 함. 아키텍처적인 구조에 의해, 언제나 세그웨이가 실행되기 직전에 이 메소드의 내용이 먼저 실행된다. 그래서 이 메소드를 세그웨이에 대한 전처리 메소드라고 부름
- prepare(for:sender:) 메소드가 호출될 때에는 항상 두 개의 인자값이 함께 전달된다. 하나는 실행된 세그웨이 자체에 대한 정보이고, 또 다른 하나는 세그웨이를 실행한 객체에 대한 정보이다.
- 세그웨이의 식별에 사용하는 값은 고유 식별값인 Identifier 속성이다.
- 출발지와 목적지 정보는 각각 source, segue.destination 속성에 저장됨. 이들 속성은 각각의 뷰 컨트롤러 참조를 UIViewController 타입으로 반환함
- 두 번째 매개변수인 sender는 이 메소드에게 메시지를 보낸 대상을 가리키는 값으로, 여기서는 세그웨이를 실행한 객체를 의미함.
- indexPath(for:) 메소드는 인자값으로 전달된 셀 객체가 테이블뷰에서 몇 번째 행에 해당하는지에 대한 정보를 IndexPath 객체 형태로 반환함
- destination은 세그웨이의 목적지에 해당하는 뷰 컨트롤러 객체를 참조하는 속성
- 세그웨이를 통해 화면을 이동할 때에는 반드시 세그웨이 객체를 통해서만 뷰 컨트롤러의 인스턴스를 참조해야 함
- 내비게이션 아이템이 추가되어 있을 경우, self.navigationItem 속성을 통해 접근할 수 있음
- 예외 처리가 잘 되어 있다고 해서 반드시 좋은 코드라고 할 수는 없지만 대부분의 좋은 코드는 적절한 예외처리를 바탕으로 함.

# 11.2 WKWebView

- load(_:) 메소드는 요청된 정보를 바탕으로 HTML 파일을 읽어들임
- 앱 내부에 저장된 로컬 HTML을 읽어들이고자 한다면 loadHTMLString(_:baseURL:) 메소드를 사용해야 함
- load(_:)는 비동기 메소드라서 웹 페이지를 완전히 다 읽어 들일 때까지 다른 프로그래밍 코드의 실행을 모두 차단하는 블로킹(Blocking) 현상이 발생하지 않음
- stopLoading() 메소드는 웹 페이지 로딩 도중에 중단하고자 할 때 사용함
- 웹 뷰의 isLoading 프로퍼티를 사용하면 웹 페이지의 로딩 진행 여부를 확인할 수 있고 임의로 속성값을 변경할 수 없도록 읽기 전용(Read-Only)으로 설정되어 있음
- 웹 페이지를 보는 도중에 이전 URL이나 다음 URL로 이동하려면 goBack()과 goForward() 메소드를 사용
- 모바일 웹과 네이티브 앱을 함께 사용해서 서비스를 구현한 앱을 웹 앱(Web App) 또는 하이브리드 앱이라고 부름
- WKWebView는 델리게이트 패턴을 통해 웹 페이지의 로딩 상황을 추적하고, 콘텐츠나 사용자의 액션을 제어할 수 있도록 지원함. 이를 위해 필요한 메소드들은 WKNavigationDelegate, WKUIDelegate에 정의되어 있음
- WKNavigationDelegate 프로토콜은 주로 웹킷 뷰의 로딩 상황을 추적하거나 제어하는 데에 필요한 내용을 담고 있음
- 위 메소드들은 우리가 직접 load(_:) 메소드를 사용하여 특정 웹 페이지를 로딩할 때 호출될 뿐만 아니라, 일단 로드된 웹 페이지에서 링크 방식으로 다른 웹 페이지를 넘어갈 때에도 마찬가지로 호출됨.
- SPA(Single Page Application: 동기 방식으로 페이지가 로딩되면 이후에는 AJAX 등을 사용하여 부분적으로만 UI를 교체해 가면서 콘텐츠를 제공하는 방식) 형태로 구성된 웹 페이지에서는 델리게이트 메소드의 호출 순서가 일반적이지 않을 수 있음
- webView(_:decidePolicyFor:decisionHandler:)는 웹 뷰가 웹 페이지를 읽어올지 말지를 결정하는 메소드
- webView(_:didStartProvisionalNavigation:)는 웹 뷰가 콘텐츠를 로드하기 시작할 때 호출되는 메소드이다. URL이 유효하지 않거나 온라인 상태일 때에도 호출됨
- webView(_:didCommit:)은 웹 뷰가 웹 콘텐츠를 받기 시작할 때 호출되는 메소드이고 대표적인 것이 로딩 상태 표시이다.
- 로딩 아이콘은 주로 액티비티 인디케이터 뷰(Activity Indicator View)를 이용하는데, webView(_:didCommit:)에 인디케이터 뷰를 화면에 표시하는 코드를 작성해두면 로딩이 시작될 때 자동으로 화면에 로딩 아이콘이 표시됨
- webView(_:didFinish:)는 웹 뷰가 콘텐츠 로딩을 완전히 마쳤을 때 호출되는 메소드
- webView(_:didFail:withError:)는 콘텐츠 로딩이 실패했을 때 호출되는 메소드
